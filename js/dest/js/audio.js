!function(){"use strict";function t(){this.initialize.apply(this,arguments)}t.prototype.initialize=function(){this.settingsData=new Map;var t=localStorage.getItem("settingsData");"undefined"!==t&&(t=JSON.parse(t),this.settingsData=new Map(t)),this.isSettingsOpen=!0,this.settingsElm=document.querySelector(".js-settings"),this.settingsRadioElm=this.settingsElm.querySelectorAll('input[type="radio"]'),this.settingsShowInputRadioElm=this.settingsElm.querySelectorAll(".js-showInputRadio"),this.settingsSelectElm=this.settingsElm.querySelectorAll("select"),this.settingsSelectNameElm=this.settingsSelectElm[0],this.settingsSelectNumElm=this.settingsSelectElm[1],this.settingsSelectRepeatElm=this.settingsSelectElm[2],this.settingsSelectSpeedElm=this.settingsSelectElm[3],this.settingsSelectAccelerationElm=this.settingsSelectElm[4],this.settingsSelectDigitElm=this.settingsSelectElm[5],this.settingsTextElm=this.settingsElm.querySelectorAll('input[type="text"]'),this.settingsInputNumElm=this.settingsTextElm[0],this.settingsInputPathElm=this.settingsTextElm[1],this.settingsInputFileName1Elm=this.settingsTextElm[2],this.settingsInputFileName2Elm=this.settingsTextElm[3],this.showElm=document.querySelector(".js-show"),this.videoElm=document.querySelector(".js-video"),this.btnElm=document.querySelector(".js-btn"),this.btnSaveElm=document.querySelector(".js-btnSave"),this.showNumElm=this.settingsInputFileName1Elm.nextSibling,this.modalElm=document.querySelectorAll(".js-modal"),this.currentSettingsName=localStorage.getItem("currentSettingsName"),this.setSettings()},t.prototype.setSettings=function(){this.currentSettingsData=this.settingsData.get(this.currentSettingsName)||"",this.path=this.currentSettingsData.path||"",this.digit=this.currentSettingsData.digit||1,this.fileName1=this.currentSettingsData.filename1||"",this.fileName2=this.currentSettingsData.filename2||"",this.num=this.currentSettingsData.no||1,this.numArray=this.currentSettingsData.array||1,this.numType=this.currentSettingsData.type||1,this.repeat=this.currentSettingsData.repeat||1,this.acceleration=this.currentSettingsData.acceleration||0,this.speedInit=this.currentSettingsData.speed||1,this.showNumElm.innerHTML=this.num,this.endNum=1e3,this.cnt=0,this.arrayIndex=0},t.prototype.setCurrentSettings=function(){this.currentSettingsName=this.settingsSelectNameElm.value,this.setSettings(),this.setValue()},t.prototype.getOption=function(e,s,i){let n="";for(let t=e;t<=s;t+=i)n+='<option value="'+Math.round(100*t)/100+'">'+Math.round(100*t)/100+"</option>";return n},t.prototype.setOption=function(){this.settingsSelectNumElm.innerHTML=this.getOption(1,1050,1),this.settingsSelectSpeedElm.innerHTML=this.getOption(.55,10,.05),this.settingsSelectAccelerationElm.innerHTML=this.getOption(0,.1,.01),this.settingsSelectRepeatElm.innerHTML=this.getOption(1,300,1),this.settingsSelectDigitElm.innerHTML=this.getOption(1,5,1);let e="";this.settingsData.forEach(t=>{e+='<option value="'+t.settingsName+'">'+t.settingsName+"</option>"}),this.settingsSelectNameElm.innerHTML=e},t.prototype.setValue=function(){this.settingsSelectNameElm.value=this.currentSettingsName,this.settingsSelectNumElm.value=this.num,this.settingsSelectRepeatElm.value=this.repeat,this.settingsSelectSpeedElm.value=this.speedInit,this.settingsSelectAccelerationElm.value=this.acceleration,this.settingsInputNumElm.value=this.numArray,this.settingsInputPathElm.value=this.path,this.settingsSelectDigitElm.value=this.digit,this.settingsInputFileName1Elm.value=this.fileName1,this.settingsInputFileName2Elm.value=this.fileName2,this.setDisplayNone()},t.prototype.setDisplayNone=function(){var t=1===this.numType?[0,1]:[1,0];this.settingsRadioElm[t[0]].checked=!0,this.settingsRadioElm[t[1]].checked=!1,this.settingsShowInputRadioElm[t[0]].classList.remove("disp--none"),this.settingsShowInputRadioElm[t[1]].classList.add("disp--none")},t.prototype.selectType=function(t){this.numType=t+1,this.setDisplayNone()},t.prototype.changeSettings=function(){var t=this.settingsSelectNameElm.value;this.currentSettingsData=this.settingsData.get(t),this.setCurrentSettings(this.currentSettingsData)},t.prototype.getShowElm=function(t){return"現在再生中の問題の番号："+t+"<br>残り："+(this.repeat-this.cnt)+"/"+this.repeat+"回<br>スピード："+this.speed+"秒<br>加速："+this.acceleration+"秒"},t.prototype.saveSettings=function(t,e,s,i,n,l,a,h,o,r,m,u){u.set(t,{settingsName:t,no:e,array:s,type:i,repeat:n,speed:l,acceleration:a,path:h,digit:o,filename1:r,filename2:m}),localStorage.setItem("settingsData",JSON.stringify([...u])),localStorage.setItem("currentSettingsName",t)},t.prototype.setShowNum=function(){this.digit=this.settingsSelectDigitElm.value;var t=this.settingsInputNumElm.value.split(","),t=1===this.numType?this.settingsSelectNumElm.value:t[0];this.showNumElm.innerHTML=this.getSerialNumber(t)},t.prototype.setNum=function(t){var e;this.isSettingsOpen?(this.settingsRadioElm[0].checked?(this.num=this.settingsSelectNumElm.value,this.numType=1):(this.numArray=this.settingsInputNumElm.value.split(","),this.numType=2),this.repeat=this.settingsSelectRepeatElm.value,this.speedInit=parseFloat(this.settingsSelectSpeedElm.value),this.speed=this.speedInit,this.acceleration=parseFloat(this.settingsSelectAccelerationElm.value),this.path=this.settingsInputPathElm.value,this.digit=parseFloat(this.settingsSelectDigitElm.value),this.fileName1=this.settingsInputFileName1Elm.value,this.fileName2=this.settingsInputFileName2Elm.value,this.currentSettingsName=this.settingsSelectNameElm.value,this.saveSettings(this.currentSettingsName,this.num,this.numArray,this.numType,this.repeat,this.speedInit,this.acceleration,this.path,this.digit,this.fileName1,this.fileName2,this.settingsData),this.settingsElm.classList.add("disp--none"),this.btnElm.innerHTML="設定を表示する",this.isSettingsOpen=!this.isSettingsOpen,this.videoElm.parentNode.className="",e=1===this.numType?this.num:this.numArray[0],this.showElm.innerHTML=this.getShowElm(e),this.setPath(e),this.videoElm.load(),this.videoPlayRateControllerSet()):(this.settingsElm.classList.remove("disp--none"),this.btnElm.innerHTML="設定して再生する",this.isSettingsOpen=!this.isSettingsOpen)},t.prototype.getSerialNumber=function(t){let e="";for(let t=0;t<this.digit;++t)e+="0";return(e+t).slice(-this.digit)},t.prototype.setPath=function(t){t=this.getSerialNumber(t),t=this.path+this.fileName1+t+this.fileName2+".mp3";this.videoElm.innerHTML='<source src="'+t+'" type="video/mp4">'},t.prototype.saveSettingsAs=function(){let s=this;function t(t,e){t.addEventListener("click",function(){for(let t=0;t<2;++t)s.modalElm[t].classList.add("disp--none");var t=document.querySelector(".js-modalInput");e&&t.value&&s.saveSettings(t.value,s.num,s.numArray,s.numType,s.repeat,s.speedInit,s.acceleration,s.path,s.digit,s.fileName1,s.fileName2,s.settingsData)})}var e=document.querySelector(".js-modalClose"),i=document.querySelector(".js-modalSaveBtn");t(e,!1),t(i,!0)},t.prototype.videoPlayRateControllerSet=function(){this.videoElm.addEventListener("loadeddata",this.videoPlayRateControllerFirstTime.bind(this)),this.videoElm.addEventListener("ended",this.videoPlayRateController.bind(this))},t.prototype.videoPlayRateControllerFirstTime=function(){this.videoElm.playbackRate=this.speed},t.prototype.videoPlayRateController=function(){1===this.numType?this.num>=this.endNum?videoElm.pause():(this.cnt>=this.repeat-1?(++this.num,this.speed=this.speedInit,this.setPath(this.num),this.cnt=0):(++this.cnt,this.speed=this.speedInit+this.cnt*this.acceleration,this.videoElm.playbackRate=this.speed),this.showElm.innerHTML=this.getShowElm(this.num),this.videoElm.load()):this.arrayIndex>=this.numArray.length?videoElm.pause():(this.cnt>=this.repeat-1?(++this.arrayIndex,this.speed=this.speedInit,this.setPath(this.numArray[this.arrayIndex]),this.cnt=0):(++this.cnt,this.speed=this.speedInit+this.cnt*this.acceleration,this.videoElm.playbackRate=this.speed),this.showElm.innerHTML=this.getShowElm(this.numArray[this.arrayIndex]),this.videoElm.load())},t.prototype.setEvent=function(){this.setOption(),this.setValue(),this.settingsSelectDigitElm.addEventListener("change",this.setShowNum.bind(this)),this.settingsSelectNumElm.addEventListener("change",this.setShowNum.bind(this)),this.settingsSelectNameElm.addEventListener("change",this.changeSettings.bind(this)),this.btnElm.addEventListener("click",this.setNum.bind(this));let e=this;for(let t=0;t<2;++t)this.settingsRadioElm[t].addEventListener("click",function(){e.selectType(t),e.setShowNum()});this.settingsInputNumElm.addEventListener("keyup",this.setShowNum.bind(this)),this.btnSaveElm.addEventListener("click",function(){e.modalElm[1].innerHTML='<button class="js-modalClose modal__close">✖️</button><span>名前：</span> <input type="text" class="js-modalInput"><br><button class="js-modalSaveBtn modal__saveBtn">保存する</button>';for(let t=0;t<2;++t)e.modalElm[t].classList.remove("disp--none");e.saveSettingsAs()})},t.prototype.run=function(){this.setEvent()},window.addEventListener("DOMContentLoaded",function(){(new t).run()})}();